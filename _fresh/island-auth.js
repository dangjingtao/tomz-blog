import{a as c,b as g}from"./chunk-J5P25FDZ.js";import{a as l}from"./chunk-ZJFVKZRZ.js";import{d}from"./chunk-BSG23BUC.js";import"./chunk-VOOYVNLC.js";var p=class{requestInterceptors=[];responseInterceptors=[];defaultConfig;constructor(e={method:"GET"}){this.defaultConfig=e}async request(e){e={...this.defaultConfig,...e};for(let n of this.requestInterceptors)e=await n(e);let t=e.url||"";if(e.baseURL&&(t=e.baseURL+t),e.params){let n=new URLSearchParams(e.params).toString();t+=`?${n}`}let a={method:e.method,headers:e.headers,body:e.body?JSON.stringify(e.body):void 0},r=await fetch(t,a),o=null;if(r.ok)if(e.responseType==="json"){let n=await r.text();try{o={status:r.status||200,data:n,error:!1,message:"success"}}catch{o={status:r.status||200,data:JSON.parse(n),error:!1,message:"success"}}}else e.responseType==="text"?o={status:r.status||200,data:await r.text(),error:!1,message:"success"}:o={status:0,message:"error response type",error:!0,data:null};else{let n=await r.json();o={status:r.status,message:n,error:!0,data:null}}for(let n of this.responseInterceptors)e=await n(o);return o}get(e,t,a){return this.request({url:e,method:"GET",params:t,headers:a})}post(e,t,a){return this.request({url:e,method:"POST",headers:a,body:t})}put(e,t,a){return this.request({url:e,method:"PUT",headers:a,body:t})}delete(e,t){return this.request({url:e,method:"DELETE",headers:t})}addRequestInterceptor(e){this.requestInterceptors.push(e)}addResponseInterceptor(e){this.responseInterceptors.push(e)}},u=new p({headers:{"Content-Type":"application/json"},responseType:"json"});u.addRequestInterceptor(s=>s);u.addResponseInterceptor(s=>{if(s.status!==200)throw new Error(`response with status ${s.status}`);return s});var i=s=>u.request(s);i.get=(s,e,t)=>u.get(s,e,t);i.post=(s,e,t)=>u.post(s,e,t);i.put=(s,e,t)=>u.put(s,e,t);i.delete=(s,e)=>u.delete(s,e);var h=i;var f=()=>{let[s,e]=c({status:"pending",message:""});return g(()=>{let a=new URLSearchParams(globalThis.location.search).get("code");a?h({url:"/api/user/auth",method:"POST",body:{code:a}}).then(r=>{console.log(r),sessionStorage.setItem("userInfo",r.data),e({status:"success",message:"Auth successful"}),globalThis.location.href="/setting"}).catch(r=>{e({status:"error",message:`Auth failed: ${r.message}`}),sessionStorage.setItem("userInfo","")}):(e({status:"error",message:"Authorization code is null"}),sessionStorage.setItem("userInfo",""))},[]),s},m=f;var I=({children:s})=>{let{status:e,message:t}=m();return l(d,{children:[e==="success"&&s,e==="pending"&&"Signing...",e==="error"&&t]})},S=I;export{S as default};
